---
- name: Fedora configuration
  become: true
  become_user: root
  block:

    - name: Install dependencies
      dnf:
        name:
          - httpd
          - python3-mod_wsgi
          - python3-jinja2
          - python3-markdown
          - python3-beautifulsoup4
          - libselinux-python
        state: latest

    - name: (fedora) Deploy apache configuration
      template:
        src: httpd.conf
        dest: /etc/httpd/conf.d/liftree.conf

    - name: Get selinux state
      command: getenforce
      register: getenforce

    - name: Manage selinux
      when: getenforce.stdout == "Enforcing"
      block:
        - name: Set selinux boolean to use home
          command: setsebool -P {{ item }} on
          loop:
            - httpd_enable_homedirs
            - httpd_read_user_content
        - name: Create empty log file
          file:
            path: "{{ liftree_logfile }}"
            state: touch
            owner: "{{ wsgi_user }}"
            group: "{{ wsgi_user }}"
        - name: Set context for log file
          sefcontext:
            target: "{{ liftree_logfile }}"
            setype: httpd_sys_rw_content_t
            state: present
        - name: Apply new SELinux file context to log file
          command: restorecon -iv {{ liftree_logfile }}

    - name: Reload apache config
      systemd:
        name: httpd
        state: reloaded
        enabled: yes
...